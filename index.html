<!DOCTYPE html>
<html>
  <head>
    <title>Spring Food Poster</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-gps-camera-component@1.7.0/dist/aframe-gps-camera-component.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-family: Arial;
        background: rgba(0,0,0,0.7);
        padding: 20px;
        border-radius: 10px;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div id="loading">Waiting for GPS... Please allow location access</div>
    
    <a-scene embedded vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true">
      <!-- Add a sky background -->
      <a-sky color="#87CEEB"></a-sky>
      
      <!-- Add some ground -->
      <a-circle rotation="-90 0 0" radius="100" color="#7CFC00"></a-circle>
      
      <a-camera gps-camera="simulateLatitude: 39.782; simulateLongitude: -84.064;" rotation-reader></a-camera>
      
      <!-- Event Poster Container -->
      <a-entity gps-entity-place="latitude: 39.782167; longitude: -84.064028">
        <a-plane 
          position="0 1.5 0"
          width="3"
          height="2"
          color="white"
          material="opacity: 0.8"
        ></a-plane>
        
        <!-- Event Text -->
        <a-text position="0 2 0" value="SPRING FOOD" align="center" color="green" width="3"></a-text>
        <a-text position="0 1.7 0" value="STUDENT UNION" align="center" color="blue" width="3"></a-text>
        <a-text position="0 1.4 0" value="FREE FOR ALL" align="center" color="red" width="3"></a-text>
        <a-text position="0 1.1 0" value="12-6 PM" align="center" color="black" width="3"></a-text>
        
        <!-- Dynamic Distance Display -->
        <a-text id="distanceText" position="0 0.8 0" align="center" color="purple" width="3"></a-text>
      </a-entity>
    </a-scene>
    
    <script>
      const eventLat = 39.782167;
      const eventLon = -84.064028;
      
      function calculateDistance(userLat, userLon) {
        const R = 6371; // Radius of Earth in km
        const dLat = (eventLat - userLat) * (Math.PI / 180);
        const dLon = (eventLon - userLon) * (Math.PI / 180);
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                  Math.cos(userLat * (Math.PI / 180)) * Math.cos(eventLat * (Math.PI / 180)) *
                  Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return (R * c).toFixed(2); // Distance in km
      }
      
      function updateDistance() {
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition((position) => {
            const distance = calculateDistance(position.coords.latitude, position.coords.longitude);
            document.getElementById("distanceText").setAttribute("value", `Distance: ${distance} km away`);
            document.getElementById("loading").style.display = "none";
          }, (error) => {
            console.error("Geolocation error: ", error);
            document.getElementById("loading").textContent = "Error getting location. Please enable GPS.";
          }, { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 });
        } else {
          document.getElementById("distanceText").setAttribute("value", "Geolocation not supported");
          document.getElementById("loading").textContent = "Geolocation not supported by your browser";
        }
      }
      
      // Start the distance updates when the scene is loaded
      document.querySelector('a-scene').addEventListener('loaded', function() {
        updateDistance();
      });
    </script>
  </body>
</html>
