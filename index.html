<!DOCTYPE html>
<html>
  <head>
    <title>Spring Food Festival AR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-gps-camera-component@1.7.0/dist/aframe-gps-camera-component.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #permissionMessage {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        background: rgba(0,0,0,0.7);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        z-index: 1000;
        font-family: Arial;
      }
    </style>
  </head>
  <body>
    <div id="permissionMessage">
      Please allow camera and location access for AR experience
    </div>

    <a-scene 
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; alpha: true"
      xr-mode-ui="enabled: true"
    >
      <!-- Camera background (real world) -->
      <a-entity id="camera-feed" position="0 0 -5"></a-entity>
      
      <!-- AR Poster Content - Positioned at GPS coordinates -->
      <a-entity gps-entity-place="latitude: 39.782167; longitude: -84.064028">
        <!-- Poster background -->
        <a-plane 
          position="0 1.5 0"
          width="3"
          height="2"
          color="white"
          material="opacity: 0.8; transparent: true"
        ></a-plane>
        
        <!-- Event details -->
        <a-text position="0 2 0" value="SPRING FOOD FESTIVAL" align="center" color="green" width="3"></a-text>
        <a-text position="0 1.7 0" value="STUDENT UNION" align="center" color="blue" width="3"></a-text>
        <a-text position="0 1.4 0" value="FREE FOR ALL STUDENTS" align="center" color="red" width="3"></a-text>
        <a-text position="0 1.1 0" value="APRIL 15TH • 12-6 PM" align="center" color="black" width="3"></a-text>
        
        <!-- Dynamic distance display -->
        <a-text id="distanceText" position="0 0.8 0" align="center" color="purple" width="3" value="Calculating distance..."></a-text>
      </a-entity>

      <!-- AR Camera setup -->
      <a-camera 
        gps-camera 
        rotation-reader
        wasd-controls="enabled: false"
        look-controls="enabled: true"
      ></a-camera>
    </a-scene>

    <script>
      // Event location coordinates
      const eventLocation = {
        latitude: 39.782167,
        longitude: -84.064028
      };
      
      // Calculate distance between two GPS points
      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // Earth radius in km
        const dLat = (lat2 - lat1) * (Math.PI / 180);
        const dLon = (lon2 - lon1) * (Math.PI / 180);
        const a = 
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
          Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return (R * c).toFixed(2); // Distance in km
      }
      
      // Initialize AR experience
      function initAR() {
        // Check for WebXR support
        if (!navigator.xr) {
          document.getElementById('permissionMessage').textContent = 
            "AR not supported in your browser. Try Chrome or Safari on mobile.";
          return;
        }
        
        // Start AR session
        const scene = document.querySelector('a-scene');
        scene.enterXR('ar', 'local-floor').then(() => {
          document.getElementById('permissionMessage').style.display = 'none';
          startLocationUpdates();
        }).catch(err => {
          console.error("AR failed to start:", err);
          document.getElementById('permissionMessage').textContent = 
            "Couldn't start AR. Make sure your device supports ARCore/ARKit.";
        });
      }
      
      // Start tracking location updates
      function startLocationUpdates() {
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(
            (position) => {
              const distance = calculateDistance(
                position.coords.latitude, 
                position.coords.longitude,
                eventLocation.latitude,
                eventLocation.longitude
              );
              
              // Update distance display
              document.getElementById("distanceText").setAttribute(
                "value", 
                `${distance} km away • ${position.coords.accuracy.toFixed(0)}m accuracy`
              );
              
              // You could add more dynamic behaviors here based on distance
              if (distance < 0.1) { // Within 100m
                document.getElementById("distanceText").setAttribute("color", "green");
              } else {
                document.getElementById("distanceText").setAttribute("color", "purple");
              }
            },
            (error) => {
              console.error("Geolocation error:", error);
              document.getElementById("distanceText").setAttribute(
                "value", 
                "Location unavailable - " + error.message
              );
            },
            { 
              enableHighAccuracy: true,
              maximumAge: 0,
              timeout: 5000
            }
          );
        } else {
          document.getElementById("distanceText").setAttribute(
            "value", 
            "Geolocation not supported"
          );
        }
      }
      
      // Initialize when scene loads
      document.querySelector('a-scene').addEventListener('loaded', initAR);
    </script>
  </body>
</html>
